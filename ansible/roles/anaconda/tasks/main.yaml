# we have to use wget here instead of the built in Ansible get_url module
# because Python versions before 2.7.9 don't support SNI, which is needed
# to verify the download via HTTPS, while wget does
- name: download anaconda
  get_url:
    url: https://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh
    dest: "{{ansible_env.HOME}}/miniconda.sh"
    mode: 0755

- name: install anaconda
  command: "./miniconda.sh -b -f chdir={{ansible_env.HOME}} creates=miniconda2"

- name: source anaconda
  lineinfile: dest={{ansible_env.HOME}}/.bashrc regexp="^export.*miniconda2/bin" line="export PATH={{ansible_env.HOME}}/miniconda2/bin:$PATH"

- name: install common python packages
  command: "{{item}} chdir={{ansible_env.HOME}}"
  with_items:
    - miniconda2/bin/conda update --yes conda
    - miniconda2/bin/conda install --yes atlas numpy scipy matplotlib dateutil pandas flask supervisor tornado
